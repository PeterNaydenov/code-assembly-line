var CodeAssemblyLine;(()=>{var e={552:e=>{"use strict";const t={notDefined:"Not defined error.",brokenTemplate:"Broken string template. Placeholder with missing closing tag.",wrongDataTemplate:"Broken data template. Object is not according the standards.",overwriteTemplate:"Error: Overwrite of existing template is not permited by configuration.",missingTemplate:'Error: Template "%s" doesn\'t exist.',wrongExtProcess:'Wrong process data. Should be an array of "processSteps".',emptyExtProcess:"Empty process! Process should contain steps(processSteps)",brokenProcess:"Broken process description.",missingOperation:'Process has step with missing operation. Set parameter "do".',overwriteProcess:'Error: Process with name "%s" is already defined.',notaValidOperation:'Error: "%s" is not a valid operation',blockExpectString:"Block expects string data. %s",dataExpectObject:"Data operations require objects. %s",overwriteData:'Error: Data with name "%s" is already defined.',processNotExists:'Error: Process "%s" does not exist.',templateNotExists:'Error: Template "%s" is not available',invalidStorageName:'Error: Process-step "save" has param "as: %s". Param "as" should be "data", "template" or "process". ',invalidJSON:'Error: Invalid JSON format was provided for saving in "processes": %s'};e.exports=function(e,r){let s=t[e]||t.notDefined;return r&&(r instanceof Array||(r=[r]),r.forEach((e=>s=s.replace("%s",e)))),s}},774:e=>{"use strict";const t={renameTemplate:function(e,t){const r=Object.keys(t);return Object.keys(e).reduce(((s,o)=>(r.includes(o)?s[t[o]]=e[o]:s[o]=e[o],s)),{})}};e.exports=t},509:e=>{"use strict";e.exports=function({showError:e}){const t={_validateProcess(t,r){let s=[];const o=t.processes.hasOwnProperty(r),a=t.processes[r];return o&&a.errors&&(s=s.concat(a.errors)),o?a.arguments.reduce(((e,t)=>("draw"==t.do&&t.tpl&&e.push(t.tpl),e)),[]).forEach((r=>{const o=t.templates[r];o&&o.errors&&(s=s.concat(o.errors)),o||s.push(e("templateNotExists",r))})):s.push(e("processNotExists",r)),s},_extractLib(e,t){const r=Object.keys(e).filter((e=>e.includes("/")));let s={};return t?s=t.reduce(((t,s)=>(r.filter((e=>0==e.indexOf(s))).forEach((r=>{const s=r.indexOf("/"),o=r.slice(s+1);t[o]=e[r].tpl.join("")})),t)),{}):Object.keys(e).forEach((t=>s[t]=e[t].tpl.join(""))),s},_flatten(e,r=[],s={}){let o=Object.assign({},s),a=!1;if(!e){const[t,s]=r.pop();a=t,e=s}for(let s in e){const n=e[s];let c=s;a&&(c=`${a}/${s}`),"function"!=typeof n&&(t._isPrimitive(n)?o[c]=n:r.push([c,n]))}return 0!=r.length?t._flatten(!1,r,o):o},_isPrimitive:e=>"object"!=typeof e};return t}},579:(e,t,r)=>{"use strict";const s=r(552),o=r(757),a=r(774),n=r(776)({chop:o,showError:s}),c=r(509)({showError:s}),i=r(29)({help:c}),l=r(245)({help:c,showError:s,operation:i}),p=r(544)({help:c,showError:s,templateTools:n}),d=r(421)({help:c,showError:s}),u=r(408)({help:c,showError:s,processTools:l}),h={htmlAttributes:["id","name","href","src","value","data","alt","role","class"]};function f(e){this.templates={},this.processes={},this.data={},this.config={},Object.keys(h).forEach((e=>this.config[e]=h[e])),e&&Object.keys(e).forEach((t=>this.config[t]=e[t]))}f.prototype={tools:a,insertTemplate:p.insert,insertTemplateLib:p.insertLib,getTemplate:p.get,getTemplateLib:p.getLib,getPlaceholders:p.getPlaceholders,renameTemplate:p.rename,removeTemplate:p.remove,insertProcess:u.insert,insertProcessLib:u.insertLib,mixProcess:u.mix,getProcessLib:u.getLib,getHooks:u.getHooks,run:u.run,renameProcess:u.rename,removeProcess:u.remove,insertData:d.insert,insertDataLib:d.insertLib,getBlock:d.getBlock,getBlocks:d.getBlock,renameData:d.rename,removeData:d.remove},e.exports=f},421:e=>{e.exports=function({help:e,showError:t}){const r={insert(t,r="add"){const s=this,o=e._flatten(t);return Object.keys(o).forEach((e=>{const t=!!s.data[e];t&&"add"==r||(t||"update"!=r)&&(t&&"heap"==r?s.data[e]+=" "+o[e]:s.data[e]=o[e])})),s},insertLib(t,r,s="add"){const o=this,a=e._flatten(t);return Object.keys(a).forEach((e=>{const t=`${r}/${e}`,n=o.data[t];n&&"add"==s||(n||"update"!=s)&&(n&&"heap"==s?o.data[t]+=" "+a[e]:o.data[t]=a[e])})),o},rename(e){const r=this,s=Object.keys(e),o=r.config.overwriteData;return s.forEach((s=>{if(!r.data[s])return;const a=e[s];!r.data[a]||o?(r.data[a]=r.data[s],delete r.data[s]):console.error(t("overwriteData",a))})),r},remove(e){const t=this;let r;return r=e instanceof Array?e:Object.keys(arguments).map((e=>arguments[e])),r.forEach((e=>delete t.data[e])),t},getBlock(e){const t=this;let r=[];return r=e instanceof Array?e:Object.keys(arguments).map((e=>arguments[e])),r.reduce(((e,r)=>e+(t.data[`block/${r}`]?t.data[`block/${r}`]:"")),"")}};return r}},408:e=>{"use strict";e.exports=function({help:e,showError:t,processTools:r}){const s={insert(e,s,o="add"){const a=this,n=a.processes[s]||!1;switch(o){case"add":if(n)return void console.error(t("overwriteProcess",s));break;case"update":if(!n)return void console.error(`Can not update process "${s}". It is still not defined.`)}return a.processes[s]=r.interpret(e),a},insertLib(e,t){return Object.keys(e).forEach((r=>{const o=t?`${t}/${r}`:r;let a;e[r]instanceof Array&&(a=[].concat(e[r]),s.insert.call(this,a,o))})),this},mix(e,r,s="add"){const o=this,a=o.processes,n=o.processes[r]||!1;let c={};switch(s){case"add":if(n)return console.error(t("overwriteProcess",r)),o;break;case"update":if(!n)return console.error(t("overwriteProcess",r)),o}return c.steps=[],c.arguments=[],c.hooks=[],e.forEach((e=>{if(!a[e])return;const t=a[e],r=t.hooks.map((t=>`${e}/${t}`)),s=t.arguments.map((t=>"hook"!=t.do?t:{do:"hook",name:`${e}/${t.name}`}));c.steps=c.steps.concat(t.steps),c.arguments=c.arguments.concat(s),c.hooks=c.hooks.concat(r)})),o.processes[r]=c,o},getLib(e){const t=this,r=Object.keys(t.processes),s=!e;return r.reduce(((r,o)=>{if(s)r[o]=t.processes[o].arguments;else if(o.includes(e)){const e=o.split("/");e.shift(),r[e.join("/")]=t.processes[o].arguments}return r}),{})},rename(e){const r=this,s=Object.keys(e),o=r.config.overwriteProcesses;return s.forEach((s=>{if(!r.processes[s])return;const a=e[s];!r.processes[a]||o?(r.processes[a]=r.processes[s],delete r.processes[s]):console.error(t("overwriteProcess",a))})),r},remove(e){const t=this;let r;return r=e instanceof Array?e:Object.keys(arguments).map((e=>arguments[e])),r.forEach((e=>delete t.processes[e])),t},getHooks(e){return this.processes.hasOwnProperty(e)?this.processes[e].hooks.reduce(((e,t)=>(e[t]=void 0,e)),{}):{}},run(t,s,o){t instanceof Array||(t=[t]);let a,n=t.reduce(((t,r)=>{const s=e._validateProcess(this,r);return t.concat(s)}),[]);if(a=null==s?[{}]:s instanceof Array?s:[s],0==n.length){let e=a;return t.forEach((t=>{e=r.run.call(this,this.processes[t],e,o)})),e}return console.error(n),n}};return s}},544:e=>{e.exports=function({help:e,templateTools:t,showError:r}){const s=t.str2intTemplate,o=t.load_interpretTemplate(s),a={insert(e,t="add"){let r=this;return Object.keys(e).forEach((s=>{const a=null!=r.templates[s];if((!a||"add"!=t)&&(a||"update"!=t))if(a&&"heap"==t){let t=r.templates[s].tpl.join("")+" "+e[s];r.templates[s]=o(t)}else r.templates[s]=o(e[s])})),r},insertLib(e,t,r="add"){let s=this;return Object.keys(e).forEach((o=>{const n={};n[`${t}/${o}`]=e[o],a.insert.call(s,n,r)})),s},rename(e){const t=this,s=Object.keys(e),o=t.config.overwriteTemplates;return s.forEach((s=>{if(!t.templates[s])return;const a=e[s];!t.templates[a]||o?(t.templates[a]=t.templates[s],delete t.templates[s]):console.error(r("overwriteTemplate"))})),t},remove(e){const t=this;let r;return r=e instanceof Array?e:Object.keys(arguments).map((e=>arguments[e])),r.forEach((e=>delete t.templates[e])),t},get(e){const t=this.templates;let r;return r=e instanceof Array?e:Object.keys(arguments).map((e=>arguments[e])),r.reduce(((e,r)=>(t[r]?e[r]=t[r].tpl.join(""):e[r]="",e)),{})},getLib(t){let r;return r=null==t?null:t instanceof Array?t:Object.keys(arguments).map((e=>arguments[e])),e._extractLib(this.templates,r)},getPlaceholders(e){const t=this.templates[e];return t?Object.keys(t.placeholders):[]}};return a}},29:e=>{"use strict";e.exports=function({help:e}){const t={draw(r){let{template:s,data:o,sharedData:a,htmlAttributes:n,missField:c,missData:i,hookFn:l}=r,p=[];return o.forEach(((r,o)=>{const d=e._flatten(r),u=Object.keys(d);let h=t._copyList(s.tpl),f=Object.assign({},s.placeholders),m=s.spaces,b="",k="";if(f._attr){const e=f._attr[0];b=m._attr&&m._attr%2?" ":"",k=m._attr&&m._attr>1?" ":"";const r=t._createAttributes(d,n).trim();h[e]=r?`${b}${r}${k}`:"",delete f._attr}if(f._count){const e=f._count;b=m._count&&m._count%2?" ":"",k=m._count&&m._count>1?" ":"",e.forEach((e=>h[e]=`${b}${o+1}${k}`)),delete f._count}u.forEach((e=>{const t=f[e];if(b=m[e]&&m[e]%2?" ":"",k=m[e]&&m[e]>1?" ":"",t){for(let r of t)h[r]=`${b}${d[e]}${k}`;delete f[e]}}));let g=Object.keys(f),y=g.length>0;if(y&&a)for(let e of g)if(a[e]){const t=f[e];b=m[e]&&m[e]%2?" ":"",k=m[e]&&m[e]>1?" ":"",t.forEach((t=>h[t]=`${b}${a[e]}${k}`)),delete f[e]}if(g=Object.keys(f),y=g.length>0,y&&c){let e;switch("_fn"==c&&"function"!=typeof l&&(c="_hide"),c){case"_fn":e=l;break;case"_hide":e=()=>"";break;case"_position":e=e=>e;break;default:e=()=>c}for(let t of g)f[t].forEach((r=>h[r]=e(t)))}if(y&&i){let e;switch("_fn"==i&&"function"!=typeof l&&(i="_hide"),i){case"_fn":e=e=>[l(e)];break;case"_hide":e=()=>[];break;default:e=()=>[i]}h=e(g)}h.length>0&&p.push(h.join(""))})),p},_createAttributes(e,t){const r={},s=new RegExp("^data-");let o="";for(let a in e)"name"!==a&&("id"!==a?"className"!==a?t.includes(a)?r[a]=`${a}="${e[a]}"`:s.test(a)&&(r[a]=`${a}="${e[a]}"`,o+=` ${r[a]}`):r.class=`class="${e[a]}"`:(r.id=`id="${e[a]}"`,r.name=`name="${e[a]}"`));return t.reduce(((e,t)=>(r[t]&&(e+=` ${r[t]}`),"data"==t&&(e+=` ${o}`),e)),"")},_copyList:e=>e.map((e=>e)),alterTemplate(e,t){const r=e.data,s=Object.keys(t),o={};return s.forEach((e=>{const s=r[e]||e;o[s]=t[e]})),o},block:(e,t)=>[e.join(t)],set(e,t){const r=e.as;return t.reduce(((e,t)=>{let s={};return s[r]=t,e.push(s),e}),[])},alter(e,r){const s=e.data,o=Object.keys(s),a=t._normalizeSelection(e.select,r.length);let n=r.map((e=>Object.assign({},e)));return a.forEach((e=>{const t=n[e],r=Object.keys(t);let a={};r.forEach((e=>{let r=t[e];o.includes(e)&&(e=s[e]),a[e]=r})),n[e]=a})),n},_normalizeSelection(e,r){let s=[];return e?("object"!=typeof e&&(e=[e]),e.forEach((e=>{if("all"==e)return s=t._generateList(r),s;switch(e){case"first":s.push(0);break;case"last":s.push(r-1);break;default:e<0?s.push(r-1+e):s.push(e-1)}})),s):(s=t._generateList(r),s)},_generateList(e){let t=[];for(let r=0;r<e;r++)t.push(r);return t},add(e,r){const s=e.data,o=Object.keys(s),a=t._normalizeSelection(e.select,r.length);let n=r.map((e=>Object.assign({},e)));return a.forEach((e=>{const r=n[e];Object.keys(r);let a=o.reduce(((e,o)=>(r[o]?e[o]=t._combineValues(r[o],s[o]):e[o]=s[o],e)),{});n[e]=Object.assign(r,a)})),n},_combineValues(e,t){let r,s=!1;return"object"!=typeof e&&(s=!0),r=s?[e]:e,r.concat(t).join(" ")},copy(e,r){const s=e.data,o=Object.keys(s),a=t._normalizeSelection(e.select,r.length),n=r.map((e=>Object.assign({},e)));return a.forEach((e=>{o.forEach((t=>{const r=n[e][t],o=s[t];n[e][o]=r}))})),n},remove(e,r){const s=e.keys,o=t._normalizeSelection(e.select,r.length),a=r.map((e=>Object.assign({},e)));return o.forEach((e=>{s.forEach((t=>{delete a[e][t]}))})),a},hook(e,r,s){return r?r(e,t.modify(this,s)):e},_findIfString:e=>"string"==typeof e[0],modify:(e,r)=>function(s,o){let a=o.do,n=t._findIfString(s),c=o.space||" ";switch(a){case"draw":const i=e._getTemplate(o.tpl,r.templates,{}),l=r.data,p=o.missField,d=o.missData,u=!1;return n?(console.error(`Hook-modifier require an 'object' data-segment but has a 'string'. {do:'draw', tpl: '${o.tpl}'}`),s):t[a]({template:i,data:s,sharedData:l,missField:p,missData:d,hookFn:u});case"set":return n?t[a](o,s):(console.error(`Hook-modifier require a 'string' data-segment but has an 'object'. { do:'${o.do}', as:'${o.as}' }`),s);case"block":return n?t[a](s,c):(console.error("Hook-modifier require a 'string' data-segment but have an 'object'. { do:'block' }"),s);default:return n?(console.error(`Data operations require objects but have strings. Data: ${s}`),s):t[a](o,s)}}};return t}},245:e=>{"use strict";const t=["draw","alterTemplate","alter","set","add","copy","remove","hook","block","save"];e.exports=function({showError:e,operation:r}){const s={interpret(e){const t={steps:[],arguments:[],hooks:[]},r=s._validate(e);return r.length>0?(t.errors=r,t):(e.forEach((e=>{t.steps.push(e.do),t.arguments.push(e),"hook"==e.do&&t.hooks.push(e.name),e.hook&&t.hooks.push(e.hook)})),t)},_validate(r){const s=[];return r instanceof Array?0==r.length?[e("emptyExtProcess")]:(r.forEach((r=>{let o=!1;r.do?(o=t.includes(r.do),o||s.push(e("notaValidOperation",[r.do]))):s.push(e("missingOperation"))})),s):[e("wrongExtProcess")]},_findIfString:e=>"string"==typeof e[0],_copyList(e){let t=e.length,r=[];for(;t--;)r[t]=e[t];return r},_parse(e){try{return JSON.parse(e)}catch(e){return!1}},_setupDrawDependencies:(e,t,r,s,o)=>({template:r,data:s,sharedData:e.data,htmlAttributes:e.config.htmlAttributes,missField:t.missField||!1,missData:t.missData||!1,hookFn:o}),_getTemplate(e,t,r){let s={},o=t[e],a=r[e]||t[e].placeholders,n=Object.keys(a);return s.tpl=o.tpl.map((e=>e)),s.spaces=Object.assign({},o.spaces),s.placeholders={},n.forEach((e=>{s.placeholders[e]=a[e].map((e=>e))})),s},run(t,o,a){let n=this,c=n.templates,i=o,l=s._findIfString(i),p=s._getTemplate,d=s._setupDrawDependencies,u={};return t.steps.forEach(((o,h)=>{const f=t.arguments[h];let m,b=f.watchHook&&a[f.watchHook]||!1,k=[],g=null!=f.space?f.space:" ",y=f.method||"add";switch(o){case"draw":m=f.tpl,l&&console.warn(e("dataExpectObject",`Step "draw" with template "${m}"`));const t=a&&a[f.hook]||!1,h=!(null==f.as);if(b)i.forEach((e=>{let[s,a]=b(e,m),i=p(a,c,u),l={};s instanceof Array||(s=[s]),l=d(n,f,i,s,t),k=k.concat(r[o](l))})),h&&(k=[k.join(g)]);else{const e=p(m,c,u),s=d(n,f,e,i,t);k=r[o](s)}h?i=i.reduce(((e,t,r)=>{switch(y){case"add":t[f.as]||(t[f.as]=k[r]);break;case"update":t[f.as]&&(t[f.as]=k[r]);break;case"overwrite":t[f.as]=k[r];break;case"heap":t[f.as]+=g+k[r]}return e.push(t),e}),[]):(i=k,l=!0);break;case"block":if(!l)return void console.error(e("blockExpectString",JSON.stringify(i)));const E=f.space||"";if(i=r[o](i,E),f.name){let e={};e[`block/${f.name}`]=i.join(""),n.insertData(e,y)}break;case"add":i=r[o](f,i);break;case"alterTemplate":m=f.tpl;const _=c[m];u[m]=r[o](f,_.placeholders);break;case"set":i=r[o](f,i),l=!1;break;case"hook":let j=f.as||!1,w=[];if(i.forEach(((e,t)=>{const c=[e,t];w.push(r[o].call(s,c,a[f.name],n)[0])})),j){i=i.map(((e,t)=>{const r=w[t],s=r instanceof Array?r.join(g):r;switch(y){case"add":e[j]||(e[j]=s);break;case"update":e[j]&&(e[j]=s);break;case"overwrite":e[j]=s;break;case"heap":e[j]+=g+s}return e}));break}i=w.reduce(((e,t)=>{const r=t instanceof Array,o=s._findIfString(t);return r&&o?(t=t.join(g),e.push(t),e):r?e=e.concat(t):(e.push(t),e)}),[]),l=s._findIfString(i);break;case"save":const O="block"!=f.as?f.name:`block/${f.name}`;let v={};switch(f.as){case"block":case"data":if(!l){console.log(e("blockExpectString",JSON.stringify(i)));break}v[O]=i.join(""),n.insertData(v,y);break;case"template":v[O]=i[0],n.insertTemplate(v,y);break;case"process":let t=s._parse(i[0]);t?n.insertProcess(t,O):console.error(e("invalidJSON",i[0]));break;default:return void console.error(e("invalidStorageName",f.as))}}})),i}};return s}},757:(e,t,r)=>{"use strict";const s=r(552);e.exports=function e(t){let r,o,a,n=[];if("string"!=typeof t)return[s("brokenTemplate")];if(0==t.length)return[];if(r=t.indexOf("{{"),0<r&&n.push(t.slice(0,r)),-1==r)return n.push(t),n;{if(a=t.indexOf("{{",r+2),o=t.indexOf("}}"),-1==o)return[s("brokenTemplate")];if(o<r)return[s("brokenTemplate")];if(o+=2,-1!=a&&a<o)return[s("brokenTemplate")];n.push(t.slice(r,o));let c=e(t.slice(o));return n.concat(c)}}},776:e=>{"use strict";e.exports=function({chop:e,showError:t}){const r={str2intTemplate(s){const o=e(s),a=o.includes(t("brokenTemplate"));let n={},c={};if(!a){const e=r._findPlaceholdersAndSpaces(o);c=e.spaces,n=e.placeholders}const i={tpl:o,placeholders:n,spaces:c};return a&&(i.errors=[t("brokenTemplate")]),i},load_interpretTemplate:e=>r=>{let s={};return s="string"==("string"==typeof r?"string":"error")?e(r):{errors:[t("wrongDataTemplate")]},s},_findPlaceholdersAndSpaces(e){const t={},r={};return e.forEach(((e,s)=>{if("{{"==e.slice(0,2)){let o=2,a=-2;const n="~~"==e.slice(2,4),c="~~"==e.slice(-4,-2);n&&(o=4),c&&(a=-4);const i=e.slice(o,a);n&&c?r[i]=3:c?r[i]=2:n&&(r[i]=1),t.hasOwnProperty(i)?t[i].push(s):t[i]=[s]}})),{spaces:r,placeholders:t}}};return r}}},t={},r=function r(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,r),a.exports}(579);CodeAssemblyLine=r})();