!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("CodeAssemblyLine",[],t):"object"==typeof exports?exports.CodeAssemblyLine=t():e.CodeAssemblyLine=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,r){"use strict";var n={notDefined:"Not defined error.",brokenTemplate:"Broken string template. Placeholder with missing closing tag.",wrongDataTemplate:"Broken data template. Object is not according the standards.",overwriteTemplate:"Error: Overwrite of existing template is not permited by configuration.",missingTemplate:'Error: Template "%s" doesn\'t exist.',wrongExtProcess:'Wrong process data. Should be an array of "processSteps".',emptyExtProcess:"Empty process! Process should contain steps(processSteps)",brokenProcess:"Broken process description.",missingOperation:'Process has step with missing operation. Set parameter "do".',overwriteProcess:'Error: Process with name "%s" is already defined.',notaValidOperation:'Error: "%s" is not a valid operation',blockExpectString:"Block expects string data. %s",dataExpectObject:"Data operations require objects. %s",overwriteData:'Error: Data with name "%s" is already defined.',processNotExists:'Error: Process "%s" does not exist.',templateNotExists:'Error: Template "%s" is not available',invalidStorageName:'Error: Process-step "save" has param "as: %s". Param "as" should be "data", "template" or "process". ',invalidJSON:'Error: Invalid JSON format was provided for saving in "processes": %s'},o=function(e,t){var r=n[e]||n.notDefined;return t&&(t instanceof Array||(t=[t]),t.forEach(function(e){return r=r.replace("%s",e)})),r};e.exports=o},function(e,t,r){"use strict";function n(e){var t=this;this.templates={},this.processes={},this.data={},this.config={},Object.keys(l).forEach(function(e){return t.config[e]=l[e]}),e&&Object.keys(e).forEach(function(r){return t.config[r]=e[r]})}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(2),i=r(4),s=r(6),c=r(0),u=a.str2intTemplate,f=a.load_interpretTemplate(u),l={overwriteTemplates:!1,overwriteProcesses:!1,overwriteData:!1,htmlAttributes:["id","name","href","src","value","data","alt","role","class"]},p={_isWritingForbidden:function(e,t,r){var n=void 0;return n="templates"==t?"overwriteTemplates":"processes"==t?"overwriteProcesses":"overwriteData",e[t].hasOwnProperty(r)&&!e.config[n]},_normalizeExternalData:function(e){return e instanceof Array?e.map(function(e){return"object"==(void 0===e?"undefined":o(e))?p._flatten(e):e}):[e]},_validateProcess:function(e,t){var r=[],n=e.processes.hasOwnProperty(t),o=e.processes[t];return n&&o.errors&&(r=r.concat(o.errors)),n?o.arguments.reduce(function(e,t){return"draw"==t.do&&t.tpl&&e.push(t.tpl),e},[]).forEach(function(t){var n=e.templates[t];n&&n.errors&&(r=r.concat(n.errors)),n||r.push(c("templateNotExists",t))}):r.push(c("processNotExists",t)),r},_validateProcessLib:function(e){try{var t=JSON.parse(e);return Object.keys(t).reduce(function(e,r){return t[r]instanceof Array&&(e[r]=[].concat(t[r])),e},{})}catch(e){return!1}},_extractLib:function(e,t){var r=Object.keys(e).filter(function(e){return e.includes("/")});return t.reduce(function(t,n){return r.filter(function(e){return 0==e.indexOf(n)}).forEach(function(r){var n=r.indexOf("/"),o=r.slice(n+1);t[o]=e[r].tpl.join("")}),t},{})},_flatten:function(e,t,r){var n=t||{};r=r||"";for(var o in e){var a=e[o],i=o;if(r&&(i=r+"/"+o),"function"!=typeof a){if(!p._isPrimitive(a))return p._flatten(a,n,i);n[i]=a}}return n},_isPrimitive:function(e){return"object"!==(void 0===e?"undefined":o(e))}},d={insert:function(e){var t=this;return Object.keys(e).forEach(function(r){if(p._isWritingForbidden(t,"templates",r))return void console.error(c("overwriteTemplate"));t.templates[r]=f(e[r])}),t},insertLib:function(e,t){var r=this;return Object.keys(e).forEach(function(n){var o={},a=t+"/"+n;if(p._isWritingForbidden(r,"templates",a))return void console.error(c("overwriteTemplate"));o[a]=e[n],d.insert.call(r,o)}),r},rename:function(e){var t=this,r=Object.keys(e),n=t.config.overwriteTemplates;return r.forEach(function(r){if(t.templates[r]){var o=e[r];if(!!t.templates[o]&&!n)return void console.error(c("overwriteTemplate"));t.templates[o]=t.templates[r],delete t.templates[r]}}),t},remove:function(e){var t=arguments,r=this,n=void 0;if(e instanceof Array)n=e;else{n=Object.keys(arguments).map(function(e){return t[e]})}return n.forEach(function(e){return delete r.templates[e]}),r},get:function(e){var t=arguments,r=this,n=r.templates,o=void 0;if(e instanceof Array)o=e;else{o=Object.keys(arguments).map(function(e){return t[e]})}return o.reduce(function(e,t){return n[t]?e[t]=n[t].tpl.join(""):e[t]="",e},{})},getLib:function(e){var t=arguments,r=this,n=void 0;if(e instanceof Array)n=e;else{n=Object.keys(arguments).map(function(e){return t[e]})}return p._extractLib(r.templates,n)},getPlaceholders:function(e){var t=this.templates[e];return t?Object.keys(t.placeholders):[]}},v={insert:function(e,t){var r=this;return p._isWritingForbidden(r,"processes",t)?void console.error(c("overwriteProcess",t)):(r.processes[t]=i.interpret(e),r)},insertLib:function(e,t){var r=this,n=p._validateProcessLib(e),o=Object.keys(n);return n&&o.forEach(function(e){var o=t?t+"/"+e:e;v.insert.call(r,n[e],o)}),r},mix:function(e,t){var r=this,n=r.processes,o={};return p._isWritingForbidden(r,"processes",t)?void console.error(c("overwriteProcess",t)):(o.steps=[],o.arguments=[],o.hooks=[],e.forEach(function(e){if(n[e]){var t=n[e],r=t.hooks.map(function(t){return e+"/"+t}),a=t.arguments.map(function(t){return"hook"!=t.do?t:{do:"hook",name:e+"/"+t.name}});o.steps=o.steps.concat(t.steps),o.arguments=o.arguments.concat(a),o.hooks=o.hooks.concat(r)}}),r.processes[t]=o,r)},getLib:function(e){var t=this,r=Object.keys(t.processes),n=!e,o=r.reduce(function(r,o){if(n)r[o]=t.processes[o];else if(o.includes(e)){var a=o.split("/");a.shift();var i=a.join("/");r[i]=t.processes[o]}return r},{});return JSON.stringify(o)},rename:function(e){var t=this,r=Object.keys(e),n=t.config.overwriteProcesses;return r.forEach(function(r){if(t.processes[r]){var o=e[r];if(!!t.processes[o]&&!n)return void console.error(c("overwriteProcess",o));t.processes[o]=t.processes[r],delete t.processes[r]}}),t},remove:function(e){var t=arguments,r=this,n=void 0;if(e instanceof Array)n=e;else{n=Object.keys(arguments).map(function(e){return t[e]})}return n.forEach(function(e){return delete r.processes[e]}),r},getHooks:function(e){if(this.processes.hasOwnProperty(e))return this.processes[e].hooks.reduce(function(e,t){return e[t]=void 0,e},{});return{}},run:function(e,t,r){var n=this;e instanceof Array||(e=[e]);var o=p._normalizeExternalData(t),a=e.reduce(function(e,t){var r=p._validateProcess(n,t);return e.concat(r)},[]);if(0==a.length){var s=o;return e.forEach(function(e){s=i.run.call(n,n.processes[e],s,r)}),s}return a}},m={insert:function(e){var t=this,r=p._flatten(e);return Object.keys(r).forEach(function(e){if(p._isWritingForbidden(t,"data",e))return void console.error(c("overwriteData",e));t.data[e]=r[e]}),t},insertLib:function(e,t){var r=this,n=p._flatten(e);return Object.keys(n).forEach(function(e){var o=t+"/"+e;if(p._isWritingForbidden(r,"data",o))return void console.error(c("overwriteData",o));r.data[o]=n[e]}),r},rename:function(e){var t=this,r=Object.keys(e),n=t.config.overwriteData;return r.forEach(function(r){if(t.data[r]){var o=e[r];if(!!t.data[o]&&!n)return void console.error(c("overwriteData",o));t.data[o]=t.data[r],delete t.data[r]}}),t},remove:function(e){var t=arguments,r=this,n=void 0;if(e instanceof Array)n=e;else{n=Object.keys(arguments).map(function(e){return t[e]})}return n.forEach(function(e){return delete r.data[e]}),r},getBlock:function(e){var t=arguments,r=this,n=[];if(e instanceof Array)n=e;else{n=Object.keys(arguments).map(function(e){return t[e]})}return n.reduce(function(e,t){return e+=r.data["block/"+t]?r.data["block/"+t]:""},"")}};n.prototype={tools:s,insertTemplate:d.insert,insertTemplateLib:d.insertLib,getTemplate:d.get,getTemplateLib:d.getLib,getPlaceholders:d.getPlaceholders,renameTemplate:d.rename,removeTemplate:d.remove,insertProcess:v.insert,insertProcessLib:v.insertLib,mixProcess:v.mix,getProcessLib:v.getLib,getHooks:v.getHooks,run:v.run,renameProcess:v.rename,removeProcess:v.remove,insertData:m.insert,insertDataLib:m.insertLib,getBlock:m.getBlock,getBlocks:m.getBlock,renameData:m.rename,removeData:m.remove},e.exports=n},function(e,t,r){"use strict";var n=r(3),o=r(0),a={str2intTemplate:function(e){var t=n(e),r=t.includes(o("brokenTemplate")),i={},s={};if(!r){var c=a._findPlaceholdersAndSpaces(t);s=c.spaces,i=c.placeholders}var u={tpl:t,placeholders:i,spaces:s};return r&&(u.errors=[o("brokenTemplate")]),u},load_interpretTemplate:function(e){return function(t){return"string"==("string"==typeof t?"string":"error")?e(t):{errors:[o("wrongDataTemplate")]}}},_findPlaceholdersAndSpaces:function(e){var t={},r={};return e.forEach(function(e,n){if("{{"==e.slice(0,2)){var o=2,a=-2,i="~~"==e.slice(2,4),s="~~"==e.slice(-4,-2);i&&(o=4),s&&(a=-4);var c=e.slice(o,a);i&&s?r[c]=3:s?r[c]=2:i&&(r[c]=1),t.hasOwnProperty(c)?t[c].push(n):t[c]=[n]}}),{spaces:r,placeholders:t}}};e.exports=a},function(e,t,r){"use strict";function n(e){var t=void 0,r=void 0,a=void 0,i=[];if("string"!=typeof e)return[o("brokenTemplate")];if(0==e.length)return[];if(t=e.indexOf("{{"),0<t&&i.push(e.slice(0,t)),-1==t)return i.push(e),i;if(a=e.indexOf("{{",t+2),-1==(r=e.indexOf("}}")))return[o("brokenTemplate")];if(r<t)return[o("brokenTemplate")];if(r+=2,-1!=a&&a<r)return[o("brokenTemplate")];i.push(e.slice(t,r));var s=e.slice(r),c=n(s);return i.concat(c)}var o=r(0);e.exports=n},function(e,t,r){"use strict";var n=r(0),o=r(5),a=["draw","alterTemplate","alter","set","add","copy","remove","hook","block","save"],i={interpret:function(e){var t={};t.steps=[],t.arguments=[],t.hooks=[];var r=i._validate(e);return r.length>0?(t.errors=r,t):(e.forEach(function(e){t.steps.push(e.do),t.arguments.push(e),"hook"==e.do&&t.hooks.push(e.name),e.hook&&t.hooks.push(e.hook)}),t)},_validate:function(e){var t=[];return e instanceof Array?0==e.length?[n("emptyExtProcess")]:(e.forEach(function(e){var r=!1;if(!e.do)return void t.push(n("missingOperation"));(r=a.includes(e.do))||t.push(n("notaValidOperation",[e.do]))}),t):[n("wrongExtProcess")]},_findIfString:function(e){return"string"==typeof e[0]},_copyList:function(e){for(var t=e.length,r=[];t--;)r[t]=e[t];return r},_parse:function(e){try{return JSON.parse(e)}catch(e){return!1}},run:function(e,t,r){var a=this,s=a.templates,c=t,u=i._findIfString(c),f={};return e.steps.forEach(function(t,l){var p=e.arguments[l],d=void 0;switch(t){case"draw":d=p.tpl,u&&console.warn(n("dataExpectObject",'Step "draw" with template "'+d+'"'));var v=p.missField||!1,m=p.missData||!1,h=!!r&&(r[p.hook]||!1),b=s[d].tpl,y=s[d].spaces,g=s[d].placeholders,k=!(null==p.as),_={};_.tpl=b,_.placeholders=f[d]||g,_.spaces=y;var O=o[t]({template:_,data:c,sharedData:a.data,htmlAttributes:a.config.htmlAttributes,missField:v,missData:m,hookFn:h});k?c=c.reduce(function(e,t,r){return t[p.as]=O[r],e.push(t),e},[]):(c=O,u=!0);break;case"block":if(!u)return void console.error(n("blockExpectString",JSON.stringify(c)));var E=p.space||"";if(c=o[t](c,E),p.name){var j={};j["block/"+p.name]=c.join(""),a.insertData(j)}break;case"add":c=o[t](p,c);break;case"alterTemplate":d=p.tpl;var w=s[d];f[d]=o[t](p,w.placeholders);break;case"set":c=o[t](p,c),u=!1;break;case"hook":var x=o[t](c,r[p.name]);c=x instanceof Array?x:[x],u=i._findIfString(c);break;case"save":var P="block"!=p.as?p.name:"block/"+p.name,S={};switch(p.as){case"block":case"data":S[P]=c.join(""),a.insertData(S);break;case"template":S[P]=c[0],a.insertTemplate(S);break;case"process":var T=i._parse(c[0]);T?a.insertProcess(T,P):console.error(n("invalidJSON",c[0]));break;default:return void console.error(n("invalidStorageName",p.as))}}}),c}};e.exports=i},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={draw:function(e){var t=e.template,r=e.data,n=e.sharedData,a=e.htmlAttributes,i=e.missField,s=e.missData,c=e.hookFn,u=[];return r.forEach(function(e,r){var f=e?Object.keys(e):[],l=o._copyList(t.tpl),p=Object.assign({},t.placeholders),d=t.spaces,v="",m="";if(p._attr){var h=p._attr[0];v=d._attr&&d._attr%2?" ":"",m=d._attr&&d._attr>1?" ":"";var b=o._createAttributes(e,a).trim();l[h]=b?""+v+b+m:"",delete p._attr}if(p._count){var y=p._count;v=d._count&&d._count%2?" ":"",m=d._count&&d._count>1?" ":"",y.forEach(function(e){return l[e]=""+v+(r+1)+m}),delete p._count}f.forEach(function(t){var r=p[t];if(v=d[t]&&d[t]%2?" ":"",m=d[t]&&d[t]>1?" ":"",r){var n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;l[c]=""+v+e[t]+m}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}delete p[t]}});var g=Object.keys(p),k=g.length>0;if(k&&n){var _=!0,O=!1,E=void 0;try{for(var j,w=g[Symbol.iterator]();!(_=(j=w.next()).done);_=!0){var x=j.value;!function(e){if(n[e]){var t=p[e];v=d[e]&&d[e]%2?" ":"",m=d[e]&&d[e]>1?" ":"",t.forEach(function(t){return l[t]=""+v+n[e]+m}),delete p[e]}}(x)}}catch(e){O=!0,E=e}finally{try{!_&&w.return&&w.return()}finally{if(O)throw E}}}if(g=Object.keys(p),k=g.length>0,k&&i&&function(){var e=void 0;switch("_fn"==i&&"function"!=typeof c&&(i="_hide"),i){case"_fn":e=c;break;case"_hide":e=function(){return""};break;case"_position":e=function(e){return e};break;default:e=function(){return i}}var t=!0,r=!1,n=void 0;try{for(var o,a=g[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;!function(t){p[t].forEach(function(r){return l[r]=e(t)})}(s)}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}(),k&&s){var P=void 0;switch("_fn"==s&&"function"!=typeof c&&(s="_hide"),s){case"_fn":P=function(e){return[c(e)]};break;case"_hide":P=function(){return[]};break;default:P=function(){return[s]}}l=P(g)}l.length>0&&u.push(l.join(""))}),u},_createAttributes:function(e,t){var r={},n=new RegExp("^data-"),o="";for(var a in e)"name"!==a&&("id"!==a?"className"!==a?t.includes(a)?r[a]=a+'="'+e[a]+'"':n.test(a)&&(r[a]=a+'="'+e[a]+'"',o+=" "+r[a]):r.class='class="'+e[a]+'"':(r.id='id="'+e[a]+'"',r.name='name="'+e[a]+'"'));return t.reduce(function(e,t){return r[t]&&(e+=" "+r[t]),"data"==t&&(e+=" "+o),e},"")},_copyList:function(e){for(var t=e.length,r=[];t--;)r[t]=e[t];return r},alterTemplate:function(e,t){var r=e.data,n=Object.keys(t),o={};return n.forEach(function(e){var n=r[e]||e;o[n]=t[e]}),o},block:function(e,t){return[e.join(t)]},set:function(e,t){var r=e.as;return t.reduce(function(e,t){var n={};return n[r]=t,e.push(n),e},[])},alter:function(e,t){var r=e.data,n=Object.keys(r),a=o._normalizeSelection(e.select,t.length),i=t.map(function(e){return Object.assign({},e)});return a.forEach(function(e){var t=i[e],o=Object.keys(t),a={};o.forEach(function(e){var o=t[e];n.includes(e)&&(e=r[e]),a[e]=o}),i[e]=a}),i},_normalizeSelection:function(e,t){var r=[];return e?("object"!=(void 0===e?"undefined":n(e))&&(e=[e]),e.forEach(function(e){if("all"==e)return r=o._generateList(t);switch(e){case"first":r.push(0);break;case"last":r.push(t-1);break;default:e<0?r.push(t-1+e):r.push(e-1)}}),r):r=o._generateList(t)},_generateList:function(e){for(var t=[],r=0;r<e;r++)t.push(r);return t},add:function(e,t){var r=e.data,n=Object.keys(r),a=o._normalizeSelection(e.select,t.length),i=t.map(function(e){return Object.assign({},e)});return a.forEach(function(e){var t=i[e],a=(Object.keys(t),n.reduce(function(e,n){return t[n]?e[n]=o._combineValues(t[n],r[n]):e[n]=r[n],e},{}));i[e]=Object.assign(t,a)}),i},_combineValues:function(e,t){var r=!1,o=void 0;return"object"!=(void 0===e?"undefined":n(e))&&(r=!0),o=r?[e]:e,o.concat(t).join(" ")},copy:function(e,t){var r=e.data,n=Object.keys(r),a=o._normalizeSelection(e.select,t.length),i=t.map(function(e){return Object.assign({},e)});return a.forEach(function(e){n.forEach(function(t){var n=i[e][t],o=r[t];i[e][o]=n})}),i},remove:function(e,t){var r=e.keys,n=o._normalizeSelection(e.select,t.length),a=t.map(function(e){return Object.assign({},e)});return n.forEach(function(e){r.forEach(function(t){delete a[e][t]})}),a},hook:function(e,t){return t?t(e,o.modify):e},_findIfString:function(e){return"string"==typeof e[0]},modify:function(e,t){var r=t.do;return o._findIfString(e)?(console.error("Data operations require objects but have strings. Data: "+e),e):o[r](t,e)}};e.exports=o},function(e,t,r){"use strict";var n={renameTemplate:function(e,t){var r=Object.keys(t);return Object.keys(e).reduce(function(n,o){return r.includes(o)?n[t[o]]=e[o]:n[o]=e[o],n},{})}};e.exports=n}])});